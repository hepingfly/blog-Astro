---
/**
 * Schema.org JSON-LD 结构化数据
 * 提供丰富的搜索结果展示
 */
import { SITE } from "@config";

export interface Props {
  type?: "BlogPosting" | "WebSite" | "WebPage";
  title?: string;
  description?: string;
  canonicalURL?: string;
  pubDatetime?: Date;
  modDatetime?: Date | null;
  ogImage?: string;
  author?: string;
}

const {
  type = "WebPage",
  title = SITE.title,
  description = SITE.desc,
  canonicalURL = new URL(Astro.url.pathname, Astro.site).href,
  pubDatetime,
  modDatetime,
  ogImage,
  author = SITE.author,
} = Astro.props;

const imageURL = ogImage
  ? new URL(ogImage, Astro.url.origin).href
  : new URL(SITE.ogImage ?? "og-default.jpg", Astro.url.origin).href;

// 构建 JSON-LD 数据
const schemaData =
  type === "BlogPosting"
    ? {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        headline: title,
        description: description,
        image: imageURL,
        datePublished: pubDatetime?.toISOString(),
        dateModified: modDatetime?.toISOString() ?? pubDatetime?.toISOString(),
        author: {
          "@type": "Person",
          name: author,
          url: SITE.profile,
        },
        publisher: {
          "@type": "Organization",
          name: SITE.title,
          logo: {
            "@type": "ImageObject",
            url: new URL("/favicon.svg", Astro.url.origin).href,
          },
        },
        mainEntityOfPage: {
          "@type": "WebPage",
          "@id": canonicalURL,
        },
      }
    : type === "WebSite"
      ? {
          "@context": "https://schema.org",
          "@type": "WebSite",
          name: SITE.title,
          description: SITE.desc,
          url: SITE.website,
          author: {
            "@type": "Person",
            name: SITE.author,
            url: SITE.profile,
          },
          potentialAction: {
            "@type": "SearchAction",
            target: {
              "@type": "EntryPoint",
              urlTemplate: `${SITE.website}search?q={search_term_string}`,
            },
            "query-input": "required name=search_term_string",
          },
        }
      : {
          "@context": "https://schema.org",
          "@type": "WebPage",
          name: title,
          description: description,
          url: canonicalURL,
          image: imageURL,
        };
---

<script type="application/ld+json" set:html={JSON.stringify(schemaData)} />
