---
import { SITE } from "@config";
import ThemeToggle from "./ThemeToggle.astro";

const pathname = new URL(Astro.request.url).pathname;
const baseUrl = import.meta.env.BASE_URL;
const normalizedBase = baseUrl.endsWith('/') ? baseUrl.slice(0, -1) : baseUrl;

const isActive = (path: string) => {
  const fullPath = `${normalizedBase}${path}`;
  return pathname === fullPath || pathname === `${fullPath}/` || pathname.startsWith(fullPath + "/");
};

const getUrl = (path: string) => `${normalizedBase}${path}`;
---

<header class="sticky top-0 z-50 bg-skin-fill/80 backdrop-blur-sm">
  <nav class="mx-auto flex max-w-3xl items-center justify-between px-4 py-6">
    <a href={getUrl("/")} class="text-2xl font-bold hover:text-skin-accent">
      {SITE.title}
    </a>
    <div class="flex items-center gap-6">
      <a
        href={getUrl("/")}
        class:list={[
          "hover:text-skin-accent",
          { "text-skin-accent": isActive("/") },
        ]}
      >
        首页
      </a>
      <a
        href={getUrl("/posts")}
        class:list={[
          "hover:text-skin-accent",
          { "text-skin-accent": isActive("/posts") },
        ]}
      >
        文章
      </a>
      <a
        href={getUrl("/tags")}
        class:list={[
          "hover:text-skin-accent",
          { "text-skin-accent": isActive("/tags") },
        ]}
      >
        标签
      </a>
      <a
        href={getUrl("/about")}
        class:list={[
          "hover:text-skin-accent",
          { "text-skin-accent": isActive("/about") },
        ]}
      >
        关于
      </a>
      <ThemeToggle />
    </div>
  </nav>
</header>
