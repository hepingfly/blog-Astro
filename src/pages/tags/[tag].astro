---
import Layout from "@layouts/Layout.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import Card from "@components/Card.astro";
import { SITE } from "@config";
import { getCollection } from "astro:content";
import getUniqueTags from "@utils/getUniqueTags";
import getPostsByTag from "@utils/getPostsByTag";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  const tags = getUniqueTags(posts);

  return tags.map(tag => ({
    params: { tag: tag.tag },
    props: { tag: tag.tagName, posts },
  }));
}

const { tag, posts } = Astro.props;
const tagPosts = getPostsByTag(posts, Astro.params.tag);
---

<Layout
  title={`标签: ${tag} | ${SITE.title}`}
  description={`包含标签 "${tag}" 的所有文章`}
>
  <Header />
  <main id="main-content">
    <section class="mx-auto max-w-3xl px-4 pb-12 pt-16">
      <h1 class="mb-2 text-3xl font-bold">
        标签: <span class="text-skin-accent">#{tag}</span>
      </h1>
      <p class="mb-8 opacity-80">共 {tagPosts.length} 篇文章</p>
      <div class="grid gap-6">
        {tagPosts.map(post => <Card post={post} />)}
      </div>
    </section>
  </main>
  <Footer />
</Layout>
