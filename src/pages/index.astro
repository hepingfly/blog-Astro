---
import Layout from "@layouts/Layout.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import Card from "@components/Card.astro";
import { SITE } from "@config";
import { getCollection } from "astro:content";
import getSortedPosts from "@utils/getSortedPosts";

const posts = await getCollection("blog");
const sortedPosts = getSortedPosts(posts);
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
const recentPosts = sortedPosts.slice(0, SITE.postPerIndex);
---

<Layout>
  <Header />
  <main id="main-content">
    <!-- Hero Section -->
    <section class="mx-auto max-w-3xl px-4 pb-12 pt-16">
      <div class="mb-8">
        <h1 class="text-4xl font-bold sm:text-5xl">{SITE.title}</h1>
        <p class="mt-4 text-lg opacity-80">
          {SITE.desc}
        </p>
      </div>
      <div class="flex gap-4">
        <a
          href="/posts"
          class="rounded-lg bg-skin-accent px-6 py-3 text-skin-inverted hover:opacity-90"
        >
          浏览文章
        </a>
        <a
          href="/tags"
          class="rounded-lg border border-skin-line px-6 py-3 hover:bg-skin-card"
        >
          查看标签
        </a>
      </div>
    </section>

    <!-- Featured Posts -->
    {
      featuredPosts.length > 0 && (
        <section class="mx-auto max-w-3xl px-4 pb-12">
          <h2 class="mb-6 text-2xl font-bold">精选文章</h2>
          <div class="grid gap-6">
            {featuredPosts.map(post => (
              <Card post={post} />
            ))}
          </div>
        </section>
      )
    }

    <!-- Recent Posts -->
    <section class="mx-auto max-w-3xl px-4 pb-12">
      <div class="mb-6 flex items-center justify-between">
        <h2 class="text-2xl font-bold">最新文章</h2>
        <a href="/posts" class="text-sm hover:text-skin-accent">
          查看全部 →
        </a>
      </div>
      <div class="grid gap-6">
        {recentPosts.map(post => <Card post={post} />)}
      </div>
    </section>
  </main>
  <Footer />
</Layout>
